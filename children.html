<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
     
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>Our Children - Orphanage Management System</title>
    <style>

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; line-height: 1.7; color: #444; background-color: #f8f9fa; }


         .navbar {
             font-family: 'Poppins', sans-serif; width: 100%; background-color: #343a40;
             position: fixed; top: 0; left: 0; z-index: 1000; display: flex;
             justify-content: space-between; align-items: center; padding: 10px 30px;
             box-shadow: 0 2px 5px rgba(0,0,0,0.1);
         }
          .navbar a { color: #f8f9fa; text-decoration: none; padding: 10px 15px; display: block; text-align: center; font-size: 0.95rem; font-weight: 500; border-radius: 4px; transition: background-color 0.3s ease, color 0.3s ease; }
          .navbar a:hover, .navbar a.active { background-color: #495057; color: #fff; }
          .navbar .navbar-brand img { height: 35px; vertical-align: middle; filter: brightness(0) invert(1); }
          .navbar .navbar-brand a { font-size: 1.25rem; font-weight: 600; text-decoration: none; color: #fff; padding: 5px 0; display: flex; align-items: center; margin-right: 20px; }
          .navbar .navbar-brand span { margin-left: 12px; }
          .navbar .navbar-brand a:hover { background-color: inherit; }
          .navbar .navbar-links { display: flex; align-items: center; }
          .navbar .navbar-links a { margin-left: 8px; }
          .navbar .user-info { display: flex; align-items: center; margin-left: auto; }
          .navbar .user-greeting { color: #e9ecef; margin-right: 15px; font-size: 0.9rem; font-weight: 500; display: none; }
          .navbar #logout-link { background-color: #dc3545; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; display: none; }
          .navbar #logout-link:hover { background-color: #c82333; }


          .admin-link, .staff-link, .public-link { display: none; }



        .main-content { margin-top: 80px; padding-bottom: 60px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .section { padding: 50px 0; }


        h1.page-title { text-align: center; margin-bottom: 50px; font-size: 2.5rem; color: #343a40; font-weight: 600; position: relative; padding-bottom: 15px; }
        h1.page-title::after { content: ''; position: absolute; display: block; width: 70px; height: 3px; background: #007bff; bottom: 0; left: 50%; transform: translateX(-50%); }


        .children-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 35px; min-height: 200px; }
        .child-profile { background-color: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 25px; text-align: center; width: 220px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .child-profile:hover { transform: translateY(-8px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .child-profile img { width: 120px; height: 120px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; border: 3px solid #e9ecef; background-color: #eee; }
        .child-profile h3 { margin-bottom: 8px; font-size: 1.2rem; color: #495057; font-weight: 600; }
        .child-profile .child-age { display: block; font-size: 0.9rem; color: #6c757d; margin-bottom: 12px; }
        .child-profile a.details-link { color: #007bff; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: inline-block; padding: 6px 15px; border: 1px solid #007bff; border-radius: 20px; transition: background-color 0.3s, color 0.3s; }
        .child-profile a.details-link:hover { background-color: #007bff; color: #fff; text-decoration: none; }

        .child-profile a.login-prompt {
             color: #fff;

             border-color: #6c757d;
             cursor: pointer;
         }
        .child-profile a.login-prompt:hover {
             background-color: #5a6268;
             border-color: #5a6268;
         }


        .footer { background-color: #343a40; color: #adb5bd; padding: 50px 0 20px 0; margin-top: 40px; }
        .footer-container { display: flex; justify-content: space-between; flex-wrap: wrap; max-width: 1200px; margin: 0 auto; padding: 0 20px; gap: 30px; }
        .footer-column { flex: 1; min-width: 220px; margin-bottom: 30px; }
        .footer-column h4 { color: #fff; margin-bottom: 20px; font-size: 1.1rem; font-weight: 600; border-bottom: 2px solid #495057; padding-bottom: 10px; }
        .footer-column p, .footer-column ul, .footer-column li { font-size: 0.95rem; color: #adb5bd; line-height: 1.8; }
        .footer-column ul { list-style: none; padding: 0; } .footer-column ul li { margin-bottom: 10px; } .footer-column ul li a { color: #adb5bd; text-decoration: none; transition: color 0.3s ease; } .footer-column ul li a:hover { color: #fff; text-decoration: none; }
        .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #495057; font-size: 0.9rem; color: #6c757d; }
    </style>
</head>
<body>

    
    <div class="navbar">
        <div class="navbar-brand">
             <a href="home.html"> 
                <img src="logo.png" alt="Orphanage Logo"> 
                 <span>Orphanage Management System</span>
            </a>
        </div>
        <div class="navbar-links">
            <a href="home.html">Home</a>
            <a href="about.html">About</a>
            <a href="children.html" class="active">Our Childrens</a> 
            <a href="contact.html">Contact</a>
             
            <a href="Views/donation.html" class="public-link">Donate</a>
            <a href="Views/admin_dashboard.html" class="admin-link">Admin Dashboard</a>
            <a href="Views/staff_dashboard.html" class="staff-link">Staff Dashboard</a>
        </div>
        <div class="user-info">
            <span class="user-greeting" id="user-greeting">Welcome!</span>
            <a href="Views/login.html" id="login-link">Login</a>
            <a href="Views/register.html" id="register-link">Register</a>
            <a href="#" id="logout-link" onclick="handleLogout(event)">Logout</a>
        </div>
    </div>

    
    <div class="main-content">
        <section class="section">
            <div class="container">
                <h1 class="page-title">Meet Our Children</h1>
                <div class="children-grid" id="children-grid-container">
                    
                    <p style="text-align: center; width: 100%; color: var(--dark-gray);">Loading children... <i class="fas fa-spinner fa-spin"></i></p>
                </div>
            </div>
        </section>
    </div>

    
    <footer class="footer">
        <div class="footer-container container">
            <div class="footer-column"><h4>Orphanage Management System</h4><p>...</p></div>
            <div class="footer-column"><h4>Quick Links</h4><ul><li><a href="home.html">Home</a></li><li><a href="children.html">Our Children</a></li><li><a href="about.html">About Us</a></li><li><a href="contact.html">Contact</a></li><li><a href="Views/donation.html" class="public-link">Donate</a></li><li><a href="Views/login.html">Login/Register</a></li></ul></div>
            <div class="footer-column"><h4>Contact Info</h4><p>...</p></div>
        </div>
        <div class="footer-bottom">Â© 2024 Orphanage Management System | All Rights Reserved</div>
    </footer>

     
     <script>
        const API_BASE_URL = 'http://localhost:8000';
        const DEFAULT_CHILD_PHOTO_ROOT = 'img/child-placeholder.png';


        function updateNavbarForUser(userData) {
            const loginLink = document.getElementById('login-link');
            const logoutLink = document.getElementById('logout-link');
            const userGreeting = document.getElementById('user-greeting');
            const registerLink = document.getElementById('register-link');
            const adminLinks = document.querySelectorAll('.admin-link');
            const staffLinks = document.querySelectorAll('.staff-link');
            const publicLinks = document.querySelectorAll('.public-link');

            adminLinks.forEach(link => link.style.display = 'none');
            staffLinks.forEach(link => link.style.display = 'none');
            publicLinks.forEach(link => link.style.display = 'none');
            if(loginLink) loginLink.style.display = 'none';
            if(logoutLink) logoutLink.style.display = 'none';
            if(userGreeting) userGreeting.style.display = 'none';
            if(registerLink) registerLink.style.display = 'none';

            if (userData && userData.username && userData.role) {
                if(logoutLink) logoutLink.style.display = 'inline-block';
                if(userGreeting) {
                    userGreeting.textContent = `Welcome, ${userData.name || userData.username}!`;
                    userGreeting.style.display = 'inline-block';
                }
                if (userData.role === 'Admin') { adminLinks.forEach(link => link.style.display = 'block'); }
                if (userData.role === 'Staff') { staffLinks.forEach(link => link.style.display = 'block'); }
                publicLinks.forEach(link => link.style.display = 'block');
            } else {

                 if(loginLink) loginLink.style.display = 'inline-block';
                 if(registerLink) registerLink.style.display = 'inline-block';
            }
        }
        function checkLoginStatus() {
            const loggedInUserData = JSON.parse(localStorage.getItem('loggedInUser') || 'null');
            updateNavbarForUser(loggedInUserData);
            return loggedInUserData;
        }
        function handleLogout(event) {
             if(event) event.preventDefault();
             localStorage.removeItem('loggedInUser');
             localStorage.removeItem('loggedInStaff');
             updateNavbarForUser(null);
             alert("You have been logged out.");
             window.location.href = "home.html";
         }

        async function fetchAndRenderChildren(isUserLoggedIn) {
            const gridContainer = document.getElementById('children-grid-container');
            gridContainer.innerHTML = `<p style="text-align: center; width: 100%; color: var(--dark-gray);">Loading children... <i class="fas fa-spinner fa-spin"></i></p>`;
            try {
                const response = await fetch(`${API_BASE_URL}/api/children`);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const children = await response.json();
                gridContainer.innerHTML = '';

                if (!children || children.length === 0) {
                    gridContainer.innerHTML = '<p style="text-align: center; width: 100%;">No children details available at the moment.</p>';
                    return;
                }

                children.forEach(child => {
                    const childDiv = document.createElement('div');
                    childDiv.className = 'child-profile';
                    const photoUrl = child.photo_url && child.photo_url !== '/uploads/default_avatar.png'
                                     ? `${API_BASE_URL}${child.photo_url}`
                                     : DEFAULT_CHILD_PHOTO_ROOT;
                    const displayName = child.first_name || 'Child';
                    const age = child.age !== undefined && child.age !== null ? `Age: ${child.age}` : 'Age: N/A';


                    let detailsLinkHTML = '';
                    if (isUserLoggedIn) {

                        detailsLinkHTML = `<a href="child-details.html?id=${child._id}" class="details-link">View Details</a>`;
                    } else {

                        detailsLinkHTML = `<a href="Views/login.html" class="details-link login-prompt">Login to View</a>`;
                    }


                    childDiv.innerHTML = `
                        <img src="${photoUrl}" alt="${displayName}" onerror="this.onerror=null; this.src='${DEFAULT_CHILD_PHOTO_ROOT}';">
                        <h3>${displayName}</h3>
                        <span class="child-age">${age}</span>
                        ${detailsLinkHTML} 
                    `;
                    gridContainer.appendChild(childDiv);
                });

            } catch (error) {
                 console.error("Error fetching children:", error);
                 gridContainer.innerHTML = '<p style="color: red; text-align: center; width: 100%;">Could not load children details. Please try again later.</p>';
            }
        }



        document.addEventListener('DOMContentLoaded', () => {
            const loggedInUser = checkLoginStatus();
            const isUserLoggedIn = loggedInUser !== null;
            fetchAndRenderChildren(isUserLoggedIn);
        });

    </script>

</body>
</html>